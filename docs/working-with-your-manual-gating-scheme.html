<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 Working with your Manual Gating Scheme | Automated Gating of Flow Cytometry Data using the Bioconductor openCyto Framework</title>
  <meta name="description" content="This tutorial was created to allow users to automate flow cytometry analysis in R using the openCyto package. The tutorial includes steps to complete automation from a flowJo Workspace file. Full details on tutorial contents are included in the following chapters.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 Working with your Manual Gating Scheme | Automated Gating of Flow Cytometry Data using the Bioconductor openCyto Framework" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This tutorial was created to allow users to automate flow cytometry analysis in R using the openCyto package. The tutorial includes steps to complete automation from a flowJo Workspace file. Full details on tutorial contents are included in the following chapters." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Working with your Manual Gating Scheme | Automated Gating of Flow Cytometry Data using the Bioconductor openCyto Framework" />
  
  <meta name="twitter:description" content="This tutorial was created to allow users to automate flow cytometry analysis in R using the openCyto package. The tutorial includes steps to complete automation from a flowJo Workspace file. Full details on tutorial contents are included in the following chapters." />
  

<meta name="author" content="Nichole Monhait, MPH Candidate">
<meta name="author" content="Colorado School of Public Health, Colorado State University">


<meta name="date" content="2019-05-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="getting-started.html">
<link rel="next" href="create-csv.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Automated Gating of Flow Cytometry Data using the Bioconductor `openCyto` Frameworke</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> What’s inside?</a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#required-packages-and-installation"><i class="fa fa-check"></i><b>2.1</b> Required Packages and Installation</a><ul>
<li class="chapter" data-level="2.1.1" data-path="getting-started.html"><a href="getting-started.html#package-descriptions"><i class="fa fa-check"></i><b>2.1.1</b> Package descriptions</a></li>
<li class="chapter" data-level="2.1.2" data-path="getting-started.html"><a href="getting-started.html#directory-set-up"><i class="fa fa-check"></i><b>2.1.2</b> Directory set-up</a></li>
<li class="chapter" data-level="2.1.3" data-path="getting-started.html"><a href="getting-started.html#installation"><i class="fa fa-check"></i><b>2.1.3</b> Installation</a></li>
<li class="chapter" data-level="2.1.4" data-path="getting-started.html"><a href="getting-started.html#load-packages"><i class="fa fa-check"></i><b>2.1.4</b> Load packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html"><i class="fa fa-check"></i><b>3</b> Working with your Manual Gating Scheme</a><ul>
<li class="chapter" data-level="3.1" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html#read-in-flowjo-file"><i class="fa fa-check"></i><b>3.1</b> Read in flowJo file</a></li>
<li class="chapter" data-level="3.2" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html#parse-fcs-files"><i class="fa fa-check"></i><b>3.2</b> Parse FCS files</a></li>
<li class="chapter" data-level="3.3" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html#visualize-and-verify"><i class="fa fa-check"></i><b>3.3</b> Visualize and Verify</a><ul>
<li class="chapter" data-level="3.3.1" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html#plot"><i class="fa fa-check"></i><b>3.3.1</b> plot()</a></li>
<li class="chapter" data-level="3.3.2" data-path="working-with-your-manual-gating-scheme.html"><a href="working-with-your-manual-gating-scheme.html#plotgate"><i class="fa fa-check"></i><b>3.3.2</b> plotGate()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="create-csv.html"><a href="create-csv.html"><i class="fa fa-check"></i><b>4</b> Create .csv</a><ul>
<li class="chapter" data-level="4.1" data-path="create-csv.html"><a href="create-csv.html#csv-gating-template-structure"><i class="fa fa-check"></i><b>4.1</b> .csv Gating Template Structure</a><ul>
<li class="chapter" data-level="4.1.1" data-path="create-csv.html"><a href="create-csv.html#alias"><i class="fa fa-check"></i><b>4.1.1</b> <code>alias</code></a></li>
<li class="chapter" data-level="4.1.2" data-path="create-csv.html"><a href="create-csv.html#pop"><i class="fa fa-check"></i><b>4.1.2</b> <code>pop</code></a></li>
<li class="chapter" data-level="4.1.3" data-path="create-csv.html"><a href="create-csv.html#parent"><i class="fa fa-check"></i><b>4.1.3</b> <code>parent</code></a></li>
<li class="chapter" data-level="4.1.4" data-path="create-csv.html"><a href="create-csv.html#remaining-template-columns"><i class="fa fa-check"></i><b>4.1.4</b> Remaining template columns</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="create-csv.html"><a href="create-csv.html#creating-the-template"><i class="fa fa-check"></i><b>4.2</b> Creating the Template</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="automate-gating.html"><a href="automate-gating.html"><i class="fa fa-check"></i><b>5</b> Automate Gating</a><ul>
<li class="chapter" data-level="5.1" data-path="automate-gating.html"><a href="automate-gating.html#load-.csv-into-r"><i class="fa fa-check"></i><b>5.1</b> Load .csv into R</a></li>
<li class="chapter" data-level="5.2" data-path="automate-gating.html"><a href="automate-gating.html#read-in-raw-fcs-files"><i class="fa fa-check"></i><b>5.2</b> Read in raw FCS files</a></li>
<li class="chapter" data-level="5.3" data-path="automate-gating.html"><a href="automate-gating.html#apply-gating"><i class="fa fa-check"></i><b>5.3</b> Apply Gating</a></li>
<li class="chapter" data-level="5.4" data-path="automate-gating.html"><a href="automate-gating.html#plot-automated-gating"><i class="fa fa-check"></i><b>5.4</b> Plot Automated Gating</a></li>
<li class="chapter" data-level="5.5" data-path="automate-gating.html"><a href="automate-gating.html#population-statistics"><i class="fa fa-check"></i><b>5.5</b> Population Statistics</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="plot-customization.html"><a href="plot-customization.html"><i class="fa fa-check"></i><b>6</b> Plot Customization</a><ul>
<li class="chapter" data-level="6.1" data-path="plot-customization.html"><a href="plot-customization.html#adjusting-plots"><i class="fa fa-check"></i><b>6.1</b> Adjusting plots</a><ul>
<li class="chapter" data-level="6.1.1" data-path="plot-customization.html"><a href="plot-customization.html#adjust-plot-axes"><i class="fa fa-check"></i><b>6.1.1</b> Adjust plot axes</a></li>
<li class="chapter" data-level="6.1.2" data-path="plot-customization.html"><a href="plot-customization.html#binning"><i class="fa fa-check"></i><b>6.1.2</b> Binning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="7" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>7</b> Appendix</a><ul>
<li class="chapter" data-level="7.1" data-path="appendix.html"><a href="appendix.html#function-definitions"><i class="fa fa-check"></i><b>7.1</b> Function Definitions</a></li>
<li class="chapter" data-level="7.2" data-path="appendix.html"><a href="appendix.html#r-object-definitions"><i class="fa fa-check"></i><b>7.2</b> R Object Definitions</a></li>
<li class="chapter" data-level="7.3" data-path="appendix.html"><a href="appendix.html#transform-data-for-better-visualization"><i class="fa fa-check"></i><b>7.3</b> Transform data for better visualization</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Automated Gating of Flow Cytometry Data using the Bioconductor <code>openCyto</code> Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-your-manual-gating-scheme" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Working with your Manual Gating Scheme</h1>
<p>The first step in this process is to bring a pre-existing flowJo file into R to recreate the gating environment. This chapter will detail the following:</p>
<ol style="list-style-type: decimal">
<li>Read in flowJo <em>.wsp</em> file<br />
</li>
<li>Parse FCS files<br />
</li>
<li>Visualize and verify manual gates</li>
</ol>
<div id="read-in-flowjo-file" class="section level2">
<h2><span class="header-section-number">3.1</span> Read in flowJo file</h2>
<p>Within flowJo, tranformation, compensation, and gating can be saved as either <em>.xml</em> or <em>.wsp</em> filetypes. This tutorial will only detail steps from a <em>.wsp</em> filetype saved from flowJo. Note that many other tutorials begin from a <em>.xml</em> filetype. Saving analysis within flowJo is detailed <a href="http://docs.flowjo.com/vx/workspaces-and-samples/ws-savinganalysis/">here</a>.</p>
<p>Your <em>.wsp</em> file will contain cell samples and groups to be added to the Workspace in R. The R Workspace is where all gates, analyses, and compensation matrices applied to samples within flowJo will be replicated and can be added to other samples in R. Importantly, the <em>.wsp</em> will not contain your FCS files. Rather, the path to your files will be saved within the <em>.wsp</em> and will be referenced later in R.</p>
<p>Before you begin, be sure you have loaded the required packages outlined in the previous chapter.</p>
<p>Once all packages are loaded, save the <em>.wsp</em> filetype path as an R object. Here, it is called <code>wsfile</code>, but you can name your R objects in any way. Next, use the <code>openWorkspace()</code> function with your R object created in the prior step to open the <em>.wsp</em> file in R. Save this as a new R object of any name. Here it is named <code>ws</code>. This new R object will be of flowJoWorkspace class.</p>
<p>Here is an example of saving and opening your <em>.wsp</em> filetype in R. Please ensure that <code>ws</code> is saved as a flowWorkspace object containing groups of samples before proceeding. This can be verified by looking in the Environment tab in the upper right pane of your screen. Next to each saved R object will list the class that the object is saved as.</p>
<pre class="sourceCode r"><code class="sourceCode r">wsfile &lt;-<span class="st"> &quot;../tutorial/group1_v_group2.wsp&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ws &lt;-<span class="st"> </span><span class="kw">openWorkspace</span>(wsfile)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(ws)</code></pre>
<pre><code>## FlowJo Workspace Version  20.0 
## File location:  ../tutorial 
## File name:  group1_v_group2.wsp 
## Workspace is open. 
## 
## Groups in Workspace
##          Name Num.Samples
## 1 All Samples          10
## 2     Samples          10</code></pre>
</div>
<div id="parse-fcs-files" class="section level2">
<h2><span class="header-section-number">3.2</span> Parse FCS files</h2>
<p>The next step is to read in raw FCS files. FCS files contain data from the flow cytometer. Standards for FCS files are listed <a href="http://software.broadinstitute.org/cancer/software/genepattern/attachments/fcs_3_1_standard.pdf">here</a>.</p>
<p>Raw FCS files are read using the <code>parseWorkspace()</code> function. This function will read the FCS files and transform, compensate, and gate according to parameters defined from the <em>.wsp</em> flowJo workspace, which is now saved as an R object of class flowWorkspace. The <code>parseWorkspace()</code> call requires the object that results from running <code>openWorkspace()</code>. Here, we named this object <code>ws</code>. The function <code>parseWorkspace()</code> also requires the name of the samples to read in. To list sample names, use the <code>getSampleGroups()</code> function on your flowWorkspace class object. You can then choose the sample names based on the results of <code>getSampleGroups()</code></p>
<p>A new R object, here named <code>gating_set</code>, is then created and will be a GatingSet object. The <code>isNcdf = TRUE</code> call saves this output to disk rather that into memory because the FCS files are large. The <code>sampNloc = 'sampleNode'</code> tells R where to retrieve the FCS file names. The options for <code>sampNloc</code> can be either “keyword” or “sampleNode”.</p>
<p>Here is an example of parsing FCS files. As this function runs, you will see several messages appear as the FCS files are loaded and the manual gating scheme is replicated. After this, <code>attributes()</code> is used to examine the data.</p>
<pre class="sourceCode r"><code class="sourceCode r">gating_set &lt;-<span class="st"> </span><span class="kw">parseWorkspace</span>(ws, <span class="dt">name =</span> <span class="st">&quot;Samples&quot;</span>, 
                             <span class="dt">path =</span> <span class="st">&quot;../tutorial/group1_v_group2&quot;</span>, 
                             <span class="dt">isNcdf =</span> <span class="ot">TRUE</span>, <span class="dt">sampNloc =</span> <span class="st">&#39;sampleNode&#39;</span>)</code></pre>
<pre><code>## windows version of flowJo workspace recognized.
## version X</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">attributes</span>(gating_set)</code></pre>
</div>
<div id="visualize-and-verify" class="section level2">
<h2><span class="header-section-number">3.3</span> Visualize and Verify</h2>
<p>It is helpful to now visualize both the gating template and gates on a subset of the data in order to verify the gating scheme. This will ensure consistency between the flowJo workspace and the manual gates recreated in R. First, save a subset of the GatingSet object type, here named <code>gating_set</code>. The following saves the first FCS file of <code>gating_set</code> as <code>gh</code>, which will be a GatingHierarchy object type. Since each FCS file corresponds to an individual experiment, this saves the first experiment of the group.</p>
<pre class="sourceCode r"><code class="sourceCode r">gh &lt;-<span class="st"> </span>gating_set[[<span class="dv">1</span>]]
<span class="kw">print</span>(gh)</code></pre>
<pre><code>## Sample:  X_group1_1 
## GatingHierarchy with  51  gates</code></pre>
<div id="plot" class="section level3">
<h3><span class="header-section-number">3.3.1</span> plot()</h3>
<p>The <code>plot()</code> function will visualize the current gating hierarchy when applied to an object of class GatingHierarchy. This can be done for the entire gating hierarchy or a specific population as seen below.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(gh)</code></pre>
<p><img src="bookdown_autogating_files/figure-html/manual_hierarchy-1.png" width="672" /></p>
</div>
<div id="plotgate" class="section level3">
<h3><span class="header-section-number">3.3.2</span> plotGate()</h3>
<p>The <code>plotGate()</code> function will gate the designated subset of your data according to parameters replicated from flowJo. This must be called on an object of class GatingHierarchy.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">flowWorkspace.par.set</span>(<span class="st">&quot;plotGate&quot;</span>, <span class="kw">list</span>(<span class="dt">xlim =</span> <span class="st">&quot;data&quot;</span>,
                                       <span class="dt">ylim =</span> <span class="st">&quot;data&quot;</span>))
<span class="kw">plotGate</span>(gh, <span class="dt">xbin =</span> <span class="dv">128</span>)</code></pre>
<p><img src="bookdown_autogating_files/figure-html/visualize_subset-1.png" width="672" /></p>
<p>**Note the use of <code>flowWorkspace.par.set()</code> and <code>xbin</code> here. Chapter 5 of this tutorial will discuss these plot customizations.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="create-csv.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown_autogating.pdf", "bookdown_autogating.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
